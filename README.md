# Postgresql-db-manager
# README: Download, Manage, and Automate PostgreSQL Database Operations

## Описание

Репозиторий содержит набор скриптов для работы с PostgreSQL, включая загрузку базы данных, создание дампов, восстановление базы данных из дампа, автоматическое удаление старых дампов и управление базой данных. 

Проект автоматизирует рутинные задачи, связанные с администрированием PostgreSQL.

---

## Основные функции

### 1. **Загрузка базы данных**
**Скрипт:** `download_example_database.sh`
- Загружает архив базы данных по указанному URL.
- Распаковывает архив.
- Импортирует SQL-файл в PostgreSQL.


### 2. **Удаление базы данных**
**Скрипт:** `drop_database.sh`
- Проверяет существование базы данных.
- Удаляет базу данных после подтверждения пользователя.

### 3. **Восстановление базы данных из дампа**
**Скрипт:** `restore_database.sh`
- Удаляет существующую базу данных.
- Создает новую базу данных.
- Восстанавливает базу данных из самого последнего дампа.

### 4. **Создание дампа базы данных (Автоматизировано в crontab)**
**Скрипт:** `create_dump.sh`
- Создает дамп указанной базы данных с текущей датой в имени файла.
- Проверяет существование дампа за текущую дату, чтобы избежать дублирования.

### 5. **Удаление старых дампов (Автоматизировано в crontab)**
**Скрипт:** `remove_old_dumps.sh`
- Удаляет дампы, которые были созданы 15 и более дней назад.
- Логирует удаленные файлы.


### 6. **Автоматизация через `crontab`**
- Автоматическое создание дампа каждый день в полночь.
- Удаление старых дампов каждую ночь в 00:05.

---

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/maria-zi/postgresql-db-manager.git
)
   cd download_postgresDB
   ```

2. Настройте файл `.pgpass` для автоматической аутентификации PostgreSQL:
   ```plaintext
   89.104.70.35:5432:demo:postgres:pass
   ```
   Замените значения на свои данные подключения к базе данных.

3. Убедитесь, что у вас установлены следующие утилиты:
   - PostgreSQL (`psql`, `pg_dump`)
   - `wget`
   - `gunzip`

---

## Использование

### 1. **Загрузка базы данных**
Запустите скрипт для загрузки базы данных:
```bash
./download_example_database.sh
```


### 2. **Удаление базы данных**
Запустите скрипт для удаления базы данных:
```bash
./drop_database.sh
```

### 3. **Восстановление базы данных из дампа**
Запустите скрипт для восстановления базы данных из последнего дампа:
```bash
./restore_database.sh
```

### 4. **Создание дампа (Автоматизировано в crontab)**
Запустите скрипт для создания дампа:
```bash
./create_dump.sh
```

### 5. **Удаление старых дампов (Автоматизировано в crontab)**
Запустите скрипт для удаления дампов старше 14 дней:
```bash
./remove_old_dumps.sh
```

---

## Автоматизация через `crontab`

Для автоматизации задач выполните команду:
```bash
crontab -e
```

Добавьте следующие строки:
```plaintext
# Ежедневное создание дампа базы данных
0 0 * * * /home/admin/postgresql-db-manager/postgresql_dump/create_dump.sh
# Удаление старых дампов
5 0 * * * /home/admin/postgresql-db-manager/postgresql_dump/remove_old_dumps.sh 
```

---

## Структура репозитория

```plaintext
postgresql-db-manager/  
├── download_example_database.sh      # Скрипт для загрузки базы данных  
├── create_dump.sh                    # Скрипт для создания дампа  
├── remove_old_dumps.sh               # Скрипт для удаления старых дампов  
├── drop_database.sh                  # Скрипт для удаления базы данных 
├── restore_database.sh               # Скрипт для восстановления базы данных из дампа  
├── .pgpass                   # Файл для автоматической аутентификации PostgreSQL  
├── crontab                   # Пример настройки автоматизации через crontab  
└── README.md                 # Документация проекта  
```

---

## Логирование

- **Лог удаления старых дампов**: `/var/log/remove_old_dumps.log`

---

## Требования

- PostgreSQL версии 10 и выше.
- Доступ к серверу PostgreSQL.
- Установленные утилиты: `wget`, `gunzip`, `find`, `pg_dump`, `psql`.

---

## Примечания

- Убедитесь, что у пользователя PostgreSQL есть права на создание/удаление базы данных и выполнение дампов.
- Все скрипты должны запускаться от имени пользователя, который имеет доступ к серверу PostgreSQL.


